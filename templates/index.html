<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>

  <head>
          <meta charset="utf-8">
          <title>Dojo Timeline</title>


        <!-- #FIXME Messes up the dojoTimeLine css .....-->
        <link type="text/css" rel="stylesheet" href="static/scripts/lib/dojo1.8.3/dijit/themes/claro/claro.css"/>
        <link type="text/css" rel="stylesheet" href="static/scripts/lib/dojo1.8.3/dojo/resources/dojo.css"/>


        <style type="text/css">

          html, body{
            width       : 100%;
            height      : 100%;
            margin      : 0;
            padding     : 0;
            font-family : Helvetica,Sans-serif,Tahoma,Ubuntu;
          }

          #dojoTimeLineWidgetContainer,
          #dojoTimeLine{
            border        : solid 1px navy;
            border-radius : 3px;
            background    : white;
            width         : 85%;
            height    : 10em;
            overflow-y    : hidden;
            overflow-x    : auto;
            cursor        : pointer;
            margin-bottom : 2%;
            margin-left   : 2%;
          }

          #dojoTimeLineWidget_0{
            background    : white;
            height    : 10em;
            overflow-y    : hidden;
            overflow-x    : auto;
            cursor        : pointer;
          }

       
         #appContainer{
           position: absolute;
           top     : 0;
           width   : 100%;
           height  : 100%;
           margin   : 0; 
          }

          #dojoTimeLineWidgetContainer{
            position      : relative;
            top           : 5%;
            left          : 5%;            
          }
          
          .hasEvent{
            background: lightgoldenrodyellow !important;
            border-radius: 5px;
            border:solid 1px green;
            box-shadow: 1px 2px 2px #aaa;
            overflow:visible;
          }

          .hasNoEvent{
            background: lightblue !important;
            border-radius: 0px;
            border:none;
            box-shadow: none;
            overflow:hidden;            
          }
        </style>

          <script type="text/javascript">
              var dojoConfig= {
                  parseOnLoad      : true,
                  async            : true,
                  baseUrl          : "./static/scripts/",
                  tlmSiblingOfDojo : false ,
                  executeScripts   : true  , 
                  isDebug          : true  ,
                  packages: [
                      { name: "dojo"         , location: "lib/dojo1.8.3/dojo" },
                      { name: "dijit"        , location: "lib/dojo1.8.3/dijit" },
                      { name: "dojox"        , location: "lib/dojo1.8.3/dojox" },
                      { name: "dojoTimeLine" , location: "custom" , main: "dojoTimeLineWidget" }
                  ]
              };
          </script>

          <script src              = "static/scripts/lib/dojo1.8.3/dojo/dojo.js"
                  type             = "text/javascript">
          </script>

          <script type="text/javascript">
              require([
                       "dojoTimeLine/dojoTimeLineWidget", 
                       "dojo/parser", 
                       "dojo/dom",
                       "dojo/on",
                       "dojo/json",
                       "dojo/request",
                       "dojo/dom-form",
                       "dojo/dom-attr",
                       "dojo/ready",
                       "dijit/registry",

                       "dijit/layout/BorderContainer", 
                       "dijit/layout/TabContainer", 
                       "dijit/layout/AccordionContainer", 
                       "dijit/layout/ContentPane", 
                       "dojox/layout/ContentPane",
                       "dijit/layout/AccordionPane",
                       "dijit/form/Select",
                       "dijit/form/Button",
                       "dijit/Dialog",
                       

                       'dojo/domReady!'],
              function(dojoTimeLineWidget, parser, dom,on,JSON, request, domForm, domAttr, ready, registry){

              ready(function(){

                //Runs the dojoTimeLine....
                console.log(dojoTimeLineWidget);

                on(dom.byId('addEventForm'), 'submit',function(e){
                   e.preventDefault();
                   var formObj  = e.target;
                   var formPost = domForm.toObject(formObj);
                   var urlToPost = domAttr.get(formObj,'action');
                   request.post(urlToPost,{data: formPost}).
                   then(function(json){ 
                           console.log("Successfully Added.");
                           var jsondata = JSON.parse(json);
                           console.log(jsondata);
                           return false;
                        }, 
                        function(err){ 
                           console.log("ERROR! Could not add event"); 
                           return false;
                        }
                   );
                   console.log(formPost);
                   return false;
                });

                on(registry.byId('showHideYearsSelect'), 
                   'change',
                   function (evt){
                      require(['dojo/_base/array'      ,
                               'dojo/query'            ,
                               'dojo/dom-style'        ,
                               'dojo/dom'              ,
                               'dojo/dom-class'        ,
                               'dojo/dom-attr'         ,
                               "dojo/NodeList-traverse"
                               ], 
                      function(array,
                               query,
                               domStyle,
                               dom, 
                               domClass, 
                               domAttr){
                        if(registry.byId('showHideYearsSelect').get('value') == 'with_events'){
                          array.forEach(query('.dojoTimeLineYearLineSpan'),
                                        function(node){
                                            if( !domClass.contains(node,'hasEvent') ){
                                              domStyle.set( node,{'display':'none'});
                                              domStyle.set( query('.dojoTimeLineYearLineSpan').parent()[0],
                                                           {width : domStyle.get( query(".dojoTimeLineWidget")[0], 
                                                                                 'width'
                                                                    ) 
                                                           }
                                              );
                                            }
                          });
                        }
                        else if(registry.byId('showHideYearsSelect').get('value') == 'all'){
                          array.forEach( query('.dojoTimeLineYearLineSpan'),
                                        function(node){
                                          domStyle.set(node,{display:'inline'});
                                          domStyle.set( query('.dojoTimeLineYearLineSpan').parent()[0],
                                                           {width : 'auto'}
                                          );
                          });
                        }
                    });
                });

              });
                
              });
          </script>

  </head>

  <body class="claro">
    <!-- 
    
    #FIXME
    
    Messes up the CSS of the dojoTimeLine div and innner divs... 
    Needs a better solution if this dosent display well inside of a Dijit Layout. 
    
    Incase this works, put the dojoTimeLine DIV inside the dojoTimeLineContainer DIV 
    as the first child

    <div id             = "appBorderContainer" 
         data-dojo-type = "dijit/layout/BorderContainer" 
         style          = "height:100%; width:100%;">
    
    <div id              = "appCenterPane" 
         data-dojo-type  = "dojox/layout/ContentPane" 
         data-dojo-props = "region:'center',splitter:true">

    </div>
    
    <div id              = "dojoTimeLineContainer" 
         data-dojo-type  = "dojox/layout/ContentPane" 
         data-dojo-props = "region:'bottom',splitter:true"
         style           = 'width:100%; height:20em; margin-bottom:10px;'>
      
    </div>
    -->

  <div id             = "appBorderContainer" 
      data-dojo-type  = "dijit/layout/BorderContainer" 
      style           = "height:100%; width:100%;"
      data-dojo-props = "gutters:true, liveSplitters:false"
      >

    <div id              = "appCenterPane" 
         data-dojo-type  = "dojox/layout/ContentPane" 
         data-dojo-props = "region:'center',splitter:true">
      
      <div id="dojoTimeLineWidgetContainer">
    
      </div>
      
      <div id="timeLineFilters"  style="position:relative; top: 20px; left: 10%; width: 30%; border: solid1px #aaa; margin-top: 20px; " >

        <div>Show Years: <span data-dojo-type = "dijit/form/Select" 
                                id             = "showHideYearsSelect">
                          <option name  = "all"              
                                  value = "all"> 
                              All
                          </option>
                          <option name  = "only_with_events" 
                                  value = "with_events"> 
                              With Events 
                          </option>
                        </span>
        </div>

      </div>

      <div id="addEventFormDiv" style="position:relative; top: 20px; margin-top: 20px">
        <form action="{{url_for('add_event')}}"  method = "post" id = "addEventForm">
          <table> 
            <tr>
              <td> Title </td> 
              <td>
                <input type            = "text" 
                      data-dojo-type  = "dijit/form/ValidationTextBox" 
                      data-dojo-props = "required:true" 
                      value           = "" 
                      name            = "title" >
              </td>
            </tr>
            <tr>
              <td> Description </td>
              <td>
                  <input data-dojo-type   = "dijit/form/SimpleTextarea" 
                        data-dojo-props  = "required:true"
                        style            = "width: 250px"
                        name             = "description" > 
                  </input>
              </td>
            </tr>
            <tr>
              <td> Date </td>
              <td><input data-dojo-type  = "dijit/form/DateTextBox" 
                         data-dojo-props = "constraints:{datePattern:'yyyy-mm-dd'}"
                         type            = "text" 
                         value           = "2013-05-06" 
                         name            = "event_date">
              </td>
            </tr>
            
            <tr> 
              <td>
                <input type           = "submit" 
                        data-dojo-type = "dijit/form/Button"
                        data-dojo-props= "label:'Add Event'"
                        value          = "Add Event" >
              </td>
            </tr>
          </table>
      </form>

      </div>


    </div>

    <div id              = "appBottomContentPane" 
         data-dojo-type  = "dojox/layout/ContentPane" 
         data-dojo-props = "region:'bottom',splitter:true"
         style           = 'width:100%; height:4em; margin-bottom:2px;'>


    </div>
 
  </div>
 
 </div>
</body>

</html>
